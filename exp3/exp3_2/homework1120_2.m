clc;
clear all;

x=[0.63853 0.033604 0.068806
0.3196 0.53086 0.65445
0.40762 0.81998 0.71836
0.96865 0.53133 0.32515
0.10563 0.61096 0.7788
0.42345 0.090823 0.26647
0.15366 0.28101 0.44009
0.52714 0.45742 0.87537
0.51805 0.94362 0.63771
0.95769 0.24071 0.67612
0.28906 0.67181 0.69514
0.067993 0.25479 0.22404]

y=[0.014557774930175571 0.6171993859981115 0.991556488360658
0.5317712339495152 0.3324402973665267 0.4055861234895181
0.8142658932850055 0.4397242285706564 0.3414822351710044
0.4887557719476766 0.9800685911904863 0.7348760811630132
0.6260142967745475 0.12434190228902697 0.28118597697209813
0.08599785857269726 0.4064484720388021 0.7938576164718256
0.29380392550470247 0.15006637875792062 0.6201149785220865
0.44437688179355705 0.5345511158527314 0.1847120058578905
0.9302431292478377 0.5582335568561066 0.42204821340837306
0.19930046034388607 0.9495440057031354 0.3840999143397348
0.6744306864689601 0.3114578573465352 0.3648026951232214
0.27355508718144006 0.06284120802996007 0.836183671120577]

plot3(x(:,1),x(:,2),x(:,3),'b.');
hold on;
plot3(y(:,1),y(:,2),y(:,3),'r.');

%?算?集均值
ux = mean(x);
uy = mean(y);

x1=x-ux;
y1=y-uy;

%?算?集?方差
sigma=x1'*y1/(length(y1));
sigma_mi = sigma - sigma';
M=sigma+sigma'-trace(sigma)*[1,0,0;0,1,0;0,0,1];

%由?方差构造4*4??矩?
Q=[trace(sigma) sigma_mi(2,3) sigma_mi(3,1) sigma_mi(1,2);
   sigma_mi(2,3) M(1,1) M(1,2) M(1,3);
   sigma_mi(3,1) M(2,1) M(2,2) M(2,3);
   sigma_mi(1,2) M(3,1) M(3,2) M(3,3)];

%?算特征值与特征向量
[m,n] = eig(Q);
e = diag(n);

%?算最大特征值??的特征向量
lamda=max(e);
for i=1:length(Q)
    if lamda==e(i)
        break;
    end
end
q=m(:,i);

q0=q(1);q1=q(2);q2=q(3);q3=q(4);

%由四元?构造旋?矩?
R=[q0^2+q1^2-q2^2-q3^2 ,2*(q1*q2-q0*q3), 2*(q1*q3+q0*q2);
   2*(q1*q2+q0*q3), q0^2-q1^2+q2^2-q3^2, 2*(q2*q3-q0*q1);
   2*(q1*q3-q0*q2), 2*(q2*q3+q0*q1), q0^2-q1^2-q2^2+q3^2];

%?算平移向量
qr=uy-ux*R';

%??旋?矩?与平移向量正确性
z = x*R'+qr;

figure;
plot3(x(:,1),x(:,2),x(:,3),'b.');
hold on;
plot3(z(:,1),z(:,2),z(:,3),'g.');

